alert:
- debug
description: Detects NotPetya ransomware activity in which the extracted passwords
  are passed back to the main module via named pipe, the file system journal of drive
  C is deleted and windows eventlogs are cleared using wevtutil
filter:
- query:
    query_string:
      query: (log_name:"Microsoft\-Windows\-Sysmon\/Operational" AND ((event_data.CommandLine.keyword:*\\AppData\\Local\\Temp\*\
        \\\\.\\pipe\* AND event_id:"1") OR (event_data.CommandLine.keyword:*.dat,#1
        AND event_id:"1" AND event_data.Image.keyword:*\\rundll32.exe) OR (event_data.CommandLine.keyword:*\
        deletejournal\ * AND event_id:"1" AND event_data.Image.keyword:*\\fsutil.exe)
        OR (event_data.CommandLine.keyword:*\ cl\ * AND event_id:"1" AND event_data.Image.keyword:*\\wevtutil.exe)
        OR *\\perfc.dat*))
index: logstash-beats-*
name: NotPetya-Ransomware-Activity_0
priority: 1
realert:
  minutes: 0
type: any


